<div class="dialog-overlay" [class.open]="isOpen()" (click)="close()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <div class="dialog-header">
      <div class="title-area">
        <lucide-icon [img]="UploadIcon" [size]="20" class="header-icon"></lucide-icon>
        <h2>Importação em Massa</h2>
      </div>
      <button class="close-btn" (click)="close()">
        <lucide-icon [img]="XIcon" [size]="24"></lucide-icon>
      </button>
    </div>

    <div class="dialog-body">
      <div class="info-banner">
        <lucide-icon [img]="InfoIcon" [size]="18"></lucide-icon>
        <p>Cole os títulos separados por vírgula. Cada título será buscado automaticamente (TMDB para filmes/anime, MAL para mangá, IGDB para jogos).</p>
      </div>

      <div class="import-options">
        <div class="option">
          <label>Tipo de Mídia</label>
          <ui-select
            [options]="mediaTypeOptions"
            [value]="selectedMediaType()"
            (valueChange)="selectedMediaType.set($event)"
            placeholder="Selecione o tipo"
            [rounding]="'full'"
          ></ui-select>
        </div>
        <div class="option">
          <label>Categoria</label>
          <ui-select
            [options]="categoryOptions()"
            [value]="selectedCategoryId()"
            (valueChange)="selectedCategoryId.set($event)"
            placeholder="Selecione a categoria"
            [rounding]="'full'"
          ></ui-select>
        </div>
      </div>

      <div class="form-group" *ngIf="status() === 'idle'">
        <label>Títulos (separados por vírgula)</label>
        <textarea 
          [(ngModel)]="importData" 
          placeholder="Cidade de Deus, Pulp Fiction, Forrest Gump, Parasita, ..."
          class="import-textarea"
          [disabled]="status() === 'processing'"
          rows="8"
        ></textarea>
        <div class="helper-text">
          <lucide-icon [img]="InfoIcon" [size]="14"></lucide-icon>
          <span>{{ getTitleCount() }} título(s) detectado(s)</span>
        </div>
      </div>

      <div class="status-area" *ngIf="status() !== 'idle'">
        <div class="progress-bar" *ngIf="status() === 'processing'">
          <div class="progress-fill" [style.width.%]="progress()"></div>
        </div>
        
        <div class="status-msg" [class]="status()">
          <lucide-icon *ngIf="status() === 'success'" [img]="CheckIcon" [size]="18"></lucide-icon>
          <lucide-icon *ngIf="status() === 'error'" [img]="AlertIcon" [size]="18"></lucide-icon>
          <lucide-icon *ngIf="status() === 'processing'" [img]="LoaderIcon" [size]="18" class="spinner"></lucide-icon>
          {{ message() }}
        </div>

        <div class="import-log" *ngIf="logs().length > 0">
          <h4>Log de Importação</h4>
          <div class="log-entries">
            @for (log of logs(); track $index) {
              <div class="log-entry" [class]="log.type">
                {{ log.message }}
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <div class="dialog-footer">
      <div class="left-actions">
        <button class="btn-outline" (click)="exportData()" [disabled]="status() === 'processing'">
          <lucide-icon [img]="DownloadIcon" [size]="18"></lucide-icon>
          Exportar para Excel
        </button>
      </div>
      <div class="right-actions">
        <button class="btn-cancel" (click)="close()">Cancelar</button>
        <button 
          class="btn-import" 
          [disabled]="!importData.trim() || status() === 'processing'"
          (click)="processImport()"
        >
          {{ status() === 'processing' ? 'Importando...' : 'Iniciar Importação' }}
        </button>
      </div>
    </div>
  </div>
</div>
