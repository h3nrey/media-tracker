<div class="kanban-container">
  @if (loading()) {
    <div class="loading">Loading...</div>
  } @else {
    <div class="kanban-board">
      @for (column of columns(); track trackByCategoryId($index, column)) {
        <div class="kanban-column">
          <div class="column-header" [style.border-color]="column.category.color">
            <div class="header-left">
              <h2>{{ column.category.name }}</h2>
              <span class="count">{{ column.media.length }}</span>
            </div>
            <button 
              class="add-column-btn" 
              [style.background]="column.category.color"
              (click)="openAddDialog(column.category.id!)"
              title="Add media to {{ column.category.name }}"
            >
              <span class="add-icon">+</span>
            </button>
          </div>

          <div
            class="anime-list"
            cdkDropList
            [id]="'column-' + $index"
            [cdkDropListData]="column.media"
            [cdkDropListConnectedTo]="getConnectedLists()"
            [cdkDropListAutoScrollDisabled]="false"
            cdkDropListOrientation="vertical"
            (cdkDropListDropped)="onDrop($event, column.category.id!)"
          >
            @for (media of column.media; track trackByMediaId($index, media)) {
              @if (media.mediaTypeId === 1) {
                <app-kanban-anime-card 
                  [anime]="media"
                  [isSelected]="selectedIds().has(media.id!)"
                  (mediaClick)="onMediaClick($event)"
                  (edit)="onEdit($event)"
                  (delete)="onDelete($event)"
                  (increment)="onIncrement($event)"
                ></app-kanban-anime-card>
              } @else if (media.mediaTypeId === 3) {
                 <app-kanban-game-card 
                  [game]="media"
                  [isSelected]="selectedIds().has(media.id!)"
                  (mediaClick)="onMediaClick($event)"
                  (edit)="onEdit($event)"
                  (delete)="onDelete($event)"
                  (increment)="onIncrement($event)"
                ></app-kanban-game-card>
              }
            } @empty {
              <div class="empty-column">
                <p>No media in this category</p>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  <app-list-view-selection-bar
    [selectedCount]="selectedIds().size"
    (deselectAll)="clearAllSelection()">
  </app-list-view-selection-bar>
</div>
