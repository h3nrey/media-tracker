<div class="mobile-library">
  <app-mobile-search-bar 
    (search)="onSearch($event)" 
    (filterClick)="onFilter()"
  ></app-mobile-search-bar>

  <app-mobile-filter-drawer
    [open]="drawerOpen()"
    [availableGenres]="availableGenres()"
    [availableStudios]="availableStudios()"
    [availableYears]="availableYears()"
    [currentFilters]="filterParams()"
    (close)="drawerOpen.set(false)"
    (update)="onUpdateFilters($event)"
    (reset)="onResetFilters()"
  ></app-mobile-filter-drawer>

  <div class="tabs-header">
    <div class="tabs-scroll" #tabsScroll>
      @for (cat of categories(); track cat.id) {
        <button 
          #tabBtn
          class="tab-btn" 
          [class.active]="cat.id === selectedCategoryId()"
          [style.border-bottom-color]="cat.id === selectedCategoryId() ? cat.color : 'transparent'"
          [style.color]="cat.id === selectedCategoryId() ? cat.color : ''"
          (click)="selectCategory(cat.id!, $event)"
        >
          <span class="tab-label">{{ cat.name }}</span>
          <span class="count" [style.background]="cat.id === selectedCategoryId() ? cat.color + '20' : ''">{{ getCount(cat.id!) }}</span>
        </button>
      }
    </div>
  </div>

  <div class="anime-grid">
    @for (anime of filteredAnime(); track anime.id) {
      <app-mobile-anime-card 
        [anime]="anime"
        [categories]="categories()"
        (click)="animeClick.emit(anime)"
        (edit)="editAnime.emit($event)"
        (move)="onMoveAnime($event)"
        (delete)="onDeleteAnime($event)"
      ></app-mobile-anime-card>
    }
    
    @if (filteredAnime().length === 0) {
      <div class="empty-state">
        No anime found
      </div>
    }
  </div>

  <app-mobile-nav 
     (manageCategories)="manageCategories.emit()"
     (manageSources)="manageSources.emit()"
  ></app-mobile-nav>

  <button class="fab-btn" (click)="onAddAnime()">
    <lucide-icon [img]="PlusIcon" [size]="24"></lucide-icon>
  </button>
</div>
