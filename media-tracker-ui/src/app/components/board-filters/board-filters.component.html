<div class="board-filters-container">
  <div class="board-toolbar">
      <!-- Group 1: Search & Primary Filter -->
      <div class="toolbar-group primary">
        <ui-search-bar 
            [(query)]="searchQuery" 
            (queryChange)="onSearchChange($event)"
            (clear)="clearSearch()">
        </ui-search-bar>

        <div class="filter-item highlight">
            <span class="label">Watched</span>
            <ui-select 
                [options]="getWatchedYearOptions()"
                [value]="currentFilters().activityYear"
                (valueChange)="toggleActivityYear($event)"
                placeholder="All Time"
                variant="prominent"
                rounding="full">
            </ui-select>
        </div>
      </div>

      <!-- Group 2: Secondary Filters -->
      <div class="toolbar-group filters">
        <ui-select 
            [options]="getGenreOptions()"
            [value]="currentFilters().genres"
            (valueChange)="toggleGenre($event)"
            placeholder="Genre">
        </ui-select>

        <ui-select 
            [options]="getStudioOptions()"
            [value]="currentFilters().studios"
            (valueChange)="toggleStudio($event)"
            placeholder="Studio">
        </ui-select>
        
        <ui-select 
            [options]="getReleaseYearOptions()"
            [value]="currentFilters().year"
            (valueChange)="selectYear(+$event)"
            placeholder="Year">
        </ui-select>
      </div>

      <!-- Group 3: Actions (Sort & View) -->
      <div class="toolbar-group actions">
          <div class="sort-wrapper">
              <ui-select 
                  [options]="getSortOptions()"
                  [value]="currentFilters().sortBy || 'updated'"
                  (valueChange)="onSortChange($event)"
                  placeholder="Sort"
                  align="right">
              </ui-select>

              <button class="icon-btn" (click)="toggleSortOrder()" [title]="currentFilters().sortOrder === 'asc' ? 'Ascending' : 'Descending'">
                  @if (currentFilters().sortOrder === 'asc') {
                      <lucide-icon [img]="SortAscIcon" [size]="18"></lucide-icon>
                  } @else {
                      <lucide-icon [img]="SortDescIcon" [size]="18"></lucide-icon>
                  }
              </button>
          </div>

          <div class="view-mode-toggle">
            <button 
              class="view-btn" 
              [class.active]="viewMode() === 'kanban'"
              (click)="setViewMode('kanban')"
              appTooltip="Board">
              <lucide-icon [img]="LayoutGridIcon" [size]="18"></lucide-icon>
            </button>
            <button 
              class="view-btn" 
              [class.active]="viewMode() === 'list'"
              (click)="setViewMode('list')"
              appTooltip="List">
              <lucide-icon [img]="ListIcon" [size]="18"></lucide-icon>
            </button>
          </div>

          @if (hasActiveFilters()) {
            <button class="clear-btn" (click)="clearAllFilters()" appTooltip="Clear Filters">
               <lucide-icon [img]="FunnelXIcon" [size]="18"></lucide-icon>
            </button>
          }
      </div>
  </div>

  @if (hasActiveFilters()) {
     <div class="active-filters-row">
          @if (currentFilters().year) {
             <div class="filter-chip" (click)="selectYear(currentFilters().year!)" title="Remove Release Year">
                Release: {{ currentFilters().year }} <lucide-icon [img]="XIcon" [size]="12"></lucide-icon>
             </div>
          }
          @for(g of currentFilters().genres; track g) {
              <div class="filter-chip" (click)="toggleGenre(g)" title="Remove Genre">
                 {{ g }} <lucide-icon [img]="XIcon" [size]="12"></lucide-icon>
              </div>
          }
          @for(s of currentFilters().studios; track s) {
              <div class="filter-chip" (click)="toggleStudio(s)" title="Remove Studio">
                 {{ s }} <lucide-icon [img]="XIcon" [size]="12"></lucide-icon>
              </div>
          }
     </div>
  }
</div>
