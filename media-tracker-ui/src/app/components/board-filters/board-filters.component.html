<div class="board-filters-container">
  <div class="board-toolbar">
      <!-- Search -->
      <ui-search-bar 
          [(query)]="searchQuery" 
          (queryChange)="onSearchChange($event)"
          (clear)="clearSearch()">
      </ui-search-bar>

      <div class="divider"></div>

      <!-- Prominent Watched Year Selector -->
      <div class="activity-year-selector">
          <span class="selector-label">Watched in</span>
          <ui-select 
              [options]="getWatchedYearOptions()"
              [value]="currentFilters().activityYear"
              (valueChange)="toggleActivityYear($event === '' ? undefined : +$event)"
              placeholder="All Time"
              variant="prominent"
              rounding="full">
          </ui-select>
      </div>

      <div class="divider"></div>

      <!-- Dropdowns -->
      <ui-select 
          [options]="getGenreOptions()"
          [value]="currentFilters().genres"
          (valueChange)="toggleGenre($event)"
          placeholder="Genre">
      </ui-select>

      <ui-select 
          [options]="getStudioOptions()"
          [value]="currentFilters().studios"
          (valueChange)="toggleStudio($event)"
          placeholder="Studio">
      </ui-select>
      
      <ui-select 
          [options]="getReleaseYearOptions()"
          [value]="currentFilters().year"
          (valueChange)="selectYear(+$event)"
          placeholder="Release Year">
      </ui-select>

      <!-- Updated Sorting UI -->
      <div class="sort-selector">
          <span class="selector-label">Ordernar por:</span>
          <div class="sort-wrapper">
              <ui-select 
                  [options]="getSortOptions()"
                  [value]="currentFilters().sortBy || 'updated'"
                  (valueChange)="onSortChange($event)"
                  placeholder="Sort By"
                  align="right">
              </ui-select>

              <button class="order-toggle-btn" (click)="toggleSortOrder()" [title]="'Change to ' + (currentFilters().sortOrder === 'asc' ? 'Descending' : 'Ascending')">
                  @if (currentFilters().sortOrder === 'asc') {
                      <lucide-icon [img]="SortAscIcon" [size]="18"></lucide-icon>
                  } @else {
                      <lucide-icon [img]="SortDescIcon" [size]="18"></lucide-icon>
                  }
              </button>
          </div>
      </div>

      <div class="divider"></div>

      <!-- View Mode Toggle -->
      <div class="view-mode-toggle">
        <button 
          class="view-btn" 
          [class.active]="viewMode() === 'kanban'"
          (click)="setViewMode('kanban')"
          appTooltip="Quadro">
          <lucide-icon [img]="LayoutGridIcon" [size]="18"></lucide-icon>
        </button>
        <button 
          class="view-btn" 
          [class.active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
          appTooltip="Lista">
          <lucide-icon [img]="ListIcon" [size]="18"></lucide-icon>
        </button>
      </div>

      @if (hasActiveFilters()) {
        <div class="divider"></div>
        <button class="clear-all-btn" (click)="clearAllFilters()" appTooltip="Limpar Filtros">
           <lucide-icon [img]="FunnelXIcon" [size]="18"></lucide-icon>
        </button>
      }
  </div>

  @if (hasActiveFilters()) {
     <div class="active-filters-row">
          @if (currentFilters().year) {
             <div class="filter-chip" (click)="selectYear(currentFilters().year!)" title="Remove Release Year">
                Release: {{ currentFilters().year }} <lucide-icon [img]="XIcon" [size]="12"></lucide-icon>
             </div>
          }
          @for(g of currentFilters().genres; track g) {
              <div class="filter-chip" (click)="toggleGenre(g)" title="Remove Genre">
                 {{ g }} <lucide-icon [img]="XIcon" [size]="12"></lucide-icon>
              </div>
          }
          @for(s of currentFilters().studios; track s) {
              <div class="filter-chip" (click)="toggleStudio(s)" title="Remove Studio">
                 {{ s }} <lucide-icon [img]="XIcon" [size]="12"></lucide-icon>
              </div>
          }
     </div>
  }
</div>
