@if(!isLoading()) {
  <div class="details-page">
    <div class="backdrop-container" [style.background-image]="'url(' + (manga()?.bannerImage || manga()?.coverImage) + ')'">
      <div class="backdrop-gradient"></div>
    </div>

    <div class="page-content">
      <div class="content-layout">
        <aside class="details-sidebar">
          <div class="poster-card">
            <img [src]="manga()?.coverImage" [alt]="manga()?.title" class="poster-image" />
          </div>

          <div class="sidebar-actions">
            <div class="action-group">
              <label>Status</label>
              <div class="status-badge" [style.border-color]="category()?.color">
                <span class="dot" [style.background]="category()?.color"></span>
                {{ category()?.name }}
              </div>
            </div>

            @if (manga()?.score && manga()!.score > 0) {
              <div class="action-group">
                <label>Rating</label>
                <div class="score-display">
                  <lucide-icon name="star" size="18" class="star-icon"></lucide-icon>
                  <span class="score-value">{{ manga()?.score }}/6</span>
                </div>
              </div>
            }

            <button class="btn-edit" (click)="onEdit()">
              <lucide-icon name="edit-3" size="16"></lucide-icon>
              Edit Details
            </button>
          </div>

          <app-media-list-section
            [mediaId]="manga()!.id!"
            [lists]="lists()"
            (updated)="onListUpdated()">
          </app-media-list-section>
        </aside>

        <div class="main-column-wrapper">
          <div class="manga-header">
            <h1 class="manga-title">{{ manga()?.title }}</h1>
            <div class="manga-meta">
              @if (manga()?.releaseYear) {
                <span class="year">{{ manga()?.releaseYear }}</span>
              }
              <span class="separator">â€¢</span>
              <span class="status">{{ manga()?.progressTotal || '?' }} Capitulos</span>
            </div>
            
            @if (manga()?.genres?.length) {
              <div class="manga-genres">
                @for (genre of manga()!.genres; track genre) {
                  <span class="genre-tag">{{ genre }}</span>
                }
              </div>
            }
          </div>

          @if (manga()?.notes) {
            <div class="manga-description">
              <h2>About</h2>
              <p>{{ manga()?.notes }}</p>
            </div>
          }

          <div class="divider"></div>

          <div class="details-sections">
            <div class="section-group full-width">
              <app-media-runs-list 
                [mediaItemId]="$any(manga()!.id)" 
                [mediaType]="'manga'"
                [totalCount]="manga()?.progressTotal || 0">
              </app-media-runs-list>
            </div>
          </div>

          <div class="reviews-wrapper">
             <app-media-reviews [supabaseId]="manga()?.supabaseId"></app-media-reviews>
          </div>
        </div>
      </div>
    </div>
  </div>
}
@else {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Loading details...</p>
  </div>
}
