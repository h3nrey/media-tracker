<aside class="side-column">
  <div class="main-poster">
    <img [src]="anime()?.coverImage" [alt]="anime()?.title">
  </div>

  <div class="sidebar-content">
    <div class="category-selector">
      <ui-select 
        [options]="categoryOptions" 
        [value]="anime()?.statusId" 
        (valueChange)="onCategoryChange($event)"
        variant="prominent"
        rounding="full">
      </ui-select>
    </div>

  <div class="score-rating" (mouseleave)="onHover(null)">
    <div class="stars">
      @for (star of [1, 2, 3, 4, 5]; track star) {
        <button 
          class="star-btn" 
          [class.filled]="(hoveredStar() !== null ? hoveredStar()! : activeRunRating) >= star"
          (mouseenter)="onHover(star)"
          (click)="setScore(star)">
          <lucide-icon [img]="StarIcon" [size]="20" fill="currentColor"></lucide-icon>
        </button>
      }
      @if (hoveredStar() === 5 || hoveredStar() === 6 || activeRunRating === 6) {
        <button 
          class="star-btn special-star" 
          [class.filled]="(hoveredStar() !== null ? hoveredStar()! : activeRunRating) >= 6"
          (mouseenter)="onHover(6)"
          (click)="setScore(6)">
          <lucide-icon [img]="StarIcon" [size]="20" fill="currentColor"></lucide-icon>
        </button>
      }
    </div>
    @if (hoveredStar() !== null) {
      <span class="score-label">{{ currentLabel }}</span>
    }
  </div>

  <div class="side-actions">
    @if (anime()?.progressTotal) {
      <div class="episode-progress">
        <div class="progress-info">
          <span>Progress</span>
          <span class="count">{{ activeRunEpisodeCount() }} / {{ anime()?.progressTotal }}</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" [style.width.%]="progress"></div>
        </div>
      </div>
    }

    @if (anime()?.trailerUrl) {
      <a [href]="anime()?.trailerUrl" target="_blank" class="btn-primary">
        <lucide-icon [img]="PlayIcon" [size]="18"></lucide-icon>
        <span>Watch Trailer</span>
      </a>
    }

    <div class="action-grid">
      <button class="btn-outline" (click)="onIncrementEpisode()" title="Add Episode">
        <lucide-icon [img]="PlusIcon" [size]="18"></lucide-icon>
      </button>
      <button class="btn-outline" (click)="onDecrementEpisode()" title="Remove Episode" [disabled]="(anime()?.progressCurrent || 0) <= 0">
        <lucide-icon [img]="MinusIcon" [size]="18"></lucide-icon>
      </button>
      <button class="btn-outline" (click)="onCompleteEpisodes()" title="Complete All" [disabled]="anime()?.progressTotal === anime()?.progressCurrent">
        <lucide-icon [img]="CheckIcon" [size]="18"></lucide-icon>
      </button>
      <button class="btn-outline" (click)="onResetEpisodes()" title="Reset Progress" [disabled]="(anime()?.progressCurrent || 0) <= 0">
        <lucide-icon [img]="ResetIcon" [size]="18"></lucide-icon>
      </button>
    </div>

    <button class="btn-outline full-width" (click)="onEdit()">
      <lucide-icon [img]="EditIcon" [size]="18"></lucide-icon>
      <span>Edit Anime</span>
    </button>
  </div>

  <div class="side-links">
    <app-anime-links [sourceLinks]="anime()?.sourceLinks" (saveLinks)="onSaveLinks($event)"></app-anime-links>
  </div>

  <div class="sidebar-lists" *ngIf="lists().length > 0">
    <div class="sidebar-section-header">
      <lucide-icon [img]="ListIcon" [size]="16"></lucide-icon>
      <h3>Associated Lists</h3>
    </div>
    <div class="compact-lists">
      @for (list of lists(); track list.id) {
        <div class="compact-list-item" [routerLink]="['/list-details', list.id]">
          <span class="list-name">{{ list.name }}</span>
          <span class="item-count">{{ list.animeIds.length }}</span>
        </div>
      }
    </div>
  </div>
</div>
</aside>
