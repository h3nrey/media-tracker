<app-stats-header
  [selectedYear]="selectedYear()"
  [yearOptions]="yearOptions()"
  [completedMedia]="completedMediaList()"
  (yearChange)="onYearChange($event)">
</app-stats-header>

<div class="stats-container">
  <!-- Stats Cards -->
  <app-stats-summary-cards
    [totalStarted]="stats().totalStarted"
    [totalCompleted]="stats().totalCompleted"
    [totalEpisodes]="stats().totalEpisodes"
    [totalTime]="stats().totalTime">
  </app-stats-summary-cards>

  <!-- Status Distribution -->
  <app-stats-distribution
    [title]="'Status'"
    [unitLabel]="currentMediaType() === MediaType.ANIME ? 'Anime' : 'Games'"
    [stats]="categoryStats()"
    [total]="stats().totalAnime">
  </app-stats-distribution>

    <!-- Top Stats Groups -->
  <div class="stats-bar-grid">
    <app-stats-bar-list
      title="Gêneros"
      [data]="stats().favoriteGenres"
      color="var(--app-primary)">
    </app-stats-bar-list>

    @if (currentMediaType() === MediaType.ANIME) {
      <app-stats-bar-list
        title="Estúdios"
        [data]="producerStats()"
        color="var(--app-primary)">
      </app-stats-bar-list>
    }

    @if (currentMediaType() !== MediaType.ANIME) {
      <app-stats-bar-list
        title="Plataformas"
        [data]="platformStats()"
        color="var(--app-primary)">
      </app-stats-bar-list>
    }

    <app-stats-bar-list
      title="Ano de Lançamento"
      [data]="releaseYearStats()"
      color="var(--app-primary)">
    </app-stats-bar-list>
  </div>

  @if (selectedYear() !== 'all') {
    <div class="stats-diary-section">
      <app-stats-diary
        [selectedYear]="selectedYear()"
        [mediaList]="allMedia()"
        [mediaType]="currentMediaType()">
      </app-stats-diary>
    </div>
  }

  @if (selectedYear() !== 'all') {
    <app-stats-gallery
      [selectedYear]="selectedYear()"
      [mediaType]="currentMediaType()"
      [mediaList]="completedMediaList()">
    </app-stats-gallery>

    <app-stats-reviews
      [mediaList]="completedMediaList()">
    </app-stats-reviews>
  }

  <app-stats-lists
    [mediaList]="allMedia()"
    [allMedia]="allMedia()">
  </app-stats-lists>

  <!-- Top Rated Anime (Podium) -->
  <app-stats-podium
    [title]="'Meus Bodes'"
    [items]="stats().topRated"
  ></app-stats-podium>

  <!-- All Watched Media -->
  <section class="all-watched-section">
    <h2>
      {{ currentMediaType() === MediaType.GAME ? 'Todos os Games Jogados' : 'Todos os Anime Assistidos' }}
      <span class="count-badge">{{ completedMediaList().length }}</span>
    </h2>

    @if (completedMediaList().length > 0) {
      <div class="media-stats-grid small">
        @for (item of completedMediaList(); track item.id) {
          <app-stats-media-card 
            [item]="item" 
            [showProgress]="true">
          </app-stats-media-card>
        }
      </div>
    } @else {
      <app-stats-empty-state
        [mainIcon]="HistoryIcon"
        [subIcon]="SearchXIcon"
        title="Nada por aqui ainda"
        description="Complete suas obras para ver seu histórico crescendo nesta seção!">
      </app-stats-empty-state>
    }
  </section>
  
  <ui-scroll-to-top></ui-scroll-to-top>
</div>
